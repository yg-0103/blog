## 스코프(Scope)

스코프란 식별자의 유효 범위를 의미한다.

```javascript
function sum(x, y) {
  console.log(x, y); // 2, 5
  return x + y;
}

sum(2, 5);

console.log(x, y); // 참조에러 매개변수 x, y 는 함수 내부에서만 참조할 수 있다.
```

모든 식별자는 자신이 선언된 위치에 의해 식별자 자신을 참조할 수 있는 유효범위가 결정된다. 이를 스코프라고 한다.

```javascript
var x = 'global';

function foo() {
  var x = 'local';
  console.log(x); // local
}

foo();

console.log(x); // global
```

위와 같은 상황에 자바스크립트 엔진은 어느 변수를 참조해야 할지 경정해야 한다. 이를 식별자 결정이라 한다. 따라서 스코프란 자바스크립트 엔진이 식별자를 검색할 때 사용하는 규칙과도 같다.

위의 선언된 x라는 변수는 식별자 이름은 동일하지만 자신이 유효한 범위 즉 스코프가 다른 별개의 변수다.

만약 변수의 스코프가 없다면 전체를 통틀어 같은 이름의 식별자는 다시는 사용할 수 없다는 소리가 되는데 이렇게 되면 변수의 이름을 결정하는 것이 매우 어려울 것이다.

## 스코프의 종류

코드는 전역과 지역으로 구분할 수 있다. 이때 전역 변수는 전역 스코프를 가지고 지 변수는 지역 스코프를 가진다. 즉 전역 스코프를 가진 변수는 어디서든 사용할 수 있는 변수이고 지역 스코프를 가진 변수는 선언된 지역에서만 사용이 가능하다.

변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드 스코프에서 시작하여 상위 스코프로 이동하며 선언된 변수를 검색한다.

그렇기 때문에 상위 스코프에서 선언된 변수는 하위 스코프에서 참조할 수 있지만 하위 스코프에 선언된 변수를 상위 스코프에서 참조할 수는 없다.

자바스크립트 엔진은 코드를 실해하기에 앞서 렉시컬 환경을 실제로 생성한다. 변수 선언이 실행되면 변수 식별자가 이 렉시컬 환경에 키로 등록되고 변수할당이 일어나면 식별자에 해당하는 값을 변경한다. 변수 검색도 이 렉시컬 환경에서 일어난다.

```javascript
// // 전역 함수
function foo() {
  console.log('global function foo');
}

function bar() {
  // 중첩 함수
  function foo() {
    console.log('local function foo');
  }

  foo();
}

bar(); // 'local function foo'

foo(); // 'global function foo'
```

함수 선언문으로 함수를 정의하면 런타임 이전에 함수 객체가 먼저 생성된다. 자바스크립트 엔진은 함수 이름과 동일한 이름의 식별자를 암묵적으로 선언하고 생성된 함수 객체를 할당한다.

### 1. 함수 레벨 스코프

함수 레벨 스코프는 코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다는 의미다. var 키워드로 선언된 변수는 함수의 코드 블럭만을 지역스코프로 인정한다.

```javascript
var x = 1;

if (true) {
  var x = 10;
}

console.log(x); // 10

function scope() {
  var x = 10;
}

console.log(x); // 1
```

### 2. 렉시컬 스코프

```javascript
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); // 1

bar(); // 1
```

위 결과는 bar 함수의 상위 스코프가 무엇인지에 따라 결정된다.

- 함수를 어디서 호출했는지에 따라 상위 스코프를 결정
- 함수를 어디서 정의했는지에 따라 상위 스코프를 결정

첫번째 방식이었다면 bar함수의 상위 스코프는 foo함수의 지역 이었을 것이고 두번째 방식이었다면 bar함수의 상위 스코프는 전역 스코프일 것이다.

첫번째 방식을 동적 스코프라 한다. 함수를 호출하는 시점에 따라 동적으로 상위스코프를 결정해야 하기 때문에 동적 스코프라 부른다.

두번째 방식을 렉시컬 스코프 또는 정적 스코프라 한다. 상위 스코프가 동적으로 변하지 않고 함수 정의가 평가되는 시점에 상위 스코프가 결정되기 떄문에 정적 스코프라 부른다. 자바스크립트는 두번째 방식인 렉시컬 스코프를 따른다.

따라서 함수의 상위 스코프는 정의가 실행될 때 결정된다. 이렇게 생성된 함수 객체는 상위 스코프를 항상 기억한다. 함수가 호출될 때마다 상위 스코프를 참조할 필요가 있기 때문이다.

출처 https://poiemaweb.com/
